id: seafile
name: Seafile
version: "11.0"
description: Open-source file sync and share platform with built-in collaboration
icon: https://www.seafile.com/media/img/seafile-logo.png
website: https://www.seafile.com
documentation: https://manual.seafile.com
categories:
  - storage
  - sync
  - collaboration

variables:
  - name: HTTP_PORT
    description: HTTP port
    type: port
    default: "8080"
    hidden: true
  - name: SEAFILE_SERVER_HOSTNAME
    description: Server hostname (e.g., seafile.example.com)
    required: true
  - name: ADMIN_EMAIL
    description: Admin email
    default: admin@example.com
    required: true
  - name: ADMIN_PASSWORD
    description: Admin password
    type: password
    generate: password
  - name: DB_PASSWORD
    description: MariaDB password
    type: password
    generate: password

ports:
  - port: 8080
    protocol: tcp
    description: Web interface

volumes:
  - name: data
    path: /shared/seafile
    description: Seafile data

compose:
  services:
    seafile:
      image: seafileltd/seafile-mc:${VERSION:-11.0-latest}
      container_name: ${APP_NAME}
      restart: unless-stopped
      environment:
        - DB_HOST=db
        - DB_ROOT_PASSWD=${DB_PASSWORD}
        - SEAFILE_SERVER_HOSTNAME=${SEAFILE_SERVER_HOSTNAME}
        - SEAFILE_ADMIN_EMAIL=${ADMIN_EMAIL}
        - SEAFILE_ADMIN_PASSWORD=${ADMIN_PASSWORD}
      volumes:
        - seafile_data:/shared
      ports:
        - "${HTTP_PORT}:80"
      depends_on:
        - db
        - memcached

    db:
      image: mariadb:10.11
      container_name: ${APP_NAME}-db
      restart: unless-stopped
      environment:
        - MYSQL_ROOT_PASSWORD=${DB_PASSWORD}
        - MYSQL_LOG_CONSOLE=true
      volumes:
        - seafile_db:/var/lib/mysql

    memcached:
      image: memcached:1.6-alpine
      container_name: ${APP_NAME}-memcached
      restart: unless-stopped
      entrypoint: memcached -m 256

  volumes:
    seafile_data:
    seafile_db:
